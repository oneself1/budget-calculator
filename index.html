<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Budget</title>
    <style>
        /* –í—Å–µ —Å—Ç–∏–ª–∏ –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π */
        /* ... (–ø–æ–ª–Ω—ã–π CSS –∫–æ–¥ –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –æ—Ç–≤–µ—Ç–∞) ... */
    </style>
</head>
<body>
    <!-- HTML —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ—Å—Ç–∞–µ—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π -->
    <!-- ... (–ø–æ–ª–Ω–∞—è HTML —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –æ—Ç–≤–µ—Ç–∞) ... -->

    <script>
        // –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è –∏ –Ω–∞–¥–µ–∂–Ω–∞—è –≤–µ—Ä—Å–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        console.log("Budget App: Starting initialization...");
        
        // –ë–∞–∑–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        let appData = {
            incomes: [],
            debts: [], 
            expenseCategories: [],
            settings: { currency: "‚ÇΩ" }
        };

        // –û–ë–ù–û–í–õ–ï–ù–ù–´–ô –°–ü–ò–°–û–ö –ö–ê–¢–ï–ì–û–†–ò–ô –†–ê–°–•–û–î–û–í
        const defaultExpenseCategories = [
            { id: 1, name: "–ü—Ä–æ–¥—É–∫—Ç—ã", amount: 0, icon: "üõí" },
            { id: 2, name: "–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç", amount: 0, icon: "üöó" },
            { id: 3, name: "–ñ–∏–ª—å–µ", amount: 0, icon: "üè†" },
            { id: 4, name: "–°–≤—è–∑—å/–∏–Ω—Ç–µ—Ä–Ω–µ—Ç", amount: 0, icon: "üì±" },
            { id: 5, name: "–û–¥–µ–∂–¥–∞", amount: 0, icon: "üëï" },
            { id: 6, name: "–†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è", amount: 0, icon: "üéÆ" },
            { id: 7, name: "–ö–∞—Ñ–µ/—Ä–µ—Å—Ç–æ—Ä–∞–Ω—ã", amount: 0, icon: "üçΩÔ∏è" },
            { id: 8, name: "–ó–¥–æ—Ä–æ–≤—å–µ", amount: 0, icon: "üè•" },
            { id: 9, name: "–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ", amount: 0, icon: "üìö" },
            { id: 10, name: "–ü–æ–¥–∞—Ä–∫–∏", amount: 0, icon: "üéÅ" },
            { id: 11, name: "–ö—Ä–∞—Å–æ—Ç–∞", amount: 0, icon: "üíÑ" },
            { id: 12, name: "–î–æ–º/–±—ã—Ç", amount: 0, icon: "üõãÔ∏è" },
            { id: 13, name: "–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏", amount: 0, icon: "üìà" }
        ];

        // –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
        function initApp() {
            console.log("Budget App: Initializing...");
            try {
                loadData();
                updateUI();
                startClock();
                console.log("Budget App: Initialized successfully");
            } catch (error) {
                console.error("Budget App: Initialization error:", error);
                // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π —Å–±—Ä–æ—Å –≤ —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏
                resetToDefaults();
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –º–∏–≥—Ä–∞—Ü–∏–µ–π
        function loadData() {
            try {
                const saved = localStorage.getItem('budgetAppData');
                if (saved) {
                    appData = JSON.parse(saved);
                    console.log("Budget App: Data loaded");
                    
                    // –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ê–Ø –ú–ò–ì–†–ê–¶–ò–Ø: –¥–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –¥–∞–Ω–Ω—ã–º
                    migrateExpenseCategories();
                } else {
                    // –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫ - —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ä–∞—Å—Ö–æ–¥–æ–≤
                    appData.expenseCategories = JSON.parse(JSON.stringify(defaultExpenseCategories));
                    saveData();
                    console.log("Budget App: First run, default categories set");
                }
            } catch (e) {
                console.error("Budget App: Error loading data, resetting", e);
                resetToDefaults();
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π —Ä–∞—Å—Ö–æ–¥–æ–≤
        function migrateExpenseCategories() {
            let migrated = false;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏ –¥–æ–±–∞–≤–ª—è–µ–º –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
            defaultExpenseCategories.forEach(defaultCategory => {
                const categoryExists = appData.expenseCategories.some(
                    category => category.id === defaultCategory.id
                );
                
                if (!categoryExists) {
                    // –î–æ–±–∞–≤–ª—è–µ–º –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é
                    appData.expenseCategories.push({
                        ...defaultCategory
                    });
                    migrated = true;
                    console.log(`Budget App: Added missing category: ${defaultCategory.name}`);
                }
            });

            // –ï—Å–ª–∏ –±—ã–ª–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏, —Å–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ
            if (migrated) {
                saveData();
                console.log("Budget App: Data migrated successfully");
            }
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
        function saveData() {
            try {
                localStorage.setItem('budgetAppData', JSON.stringify(appData));
                updateUI();
            } catch (e) {
                console.error("Budget App: Error saving data", e);
            }
        }

        // –°–±—Ä–æ—Å –∫ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        function resetToDefaults() {
            appData = {
                incomes: [],
                debts: [], 
                expenseCategories: JSON.parse(JSON.stringify(defaultExpenseCategories)),
                settings: { currency: "‚ÇΩ" }
            };
            saveData();
        }

        // –û—Å—Ç–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
        // ... (–≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –∫–æ–¥–∞) ...

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–π —Ä–∞—Å—Ö–æ–¥–æ–≤
        function updateExpenseCategories() {
            const container = document.getElementById('expense-circles');
            if (!container) return;
            
            if (!appData.expenseCategories || appData.expenseCategories.length === 0) {
                container.innerHTML = '<div class="empty-state">–ù–∞–∂–º–∏ + —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å</div>';
                return;
            }
            
            container.innerHTML = appData.expenseCategories.map(category => {
                const isDefaultCategory = defaultExpenseCategories.some(cat => cat.id === category.id);
                const showAmount = category.amount > 0;
                const icon = category.icon || 'üõí';
                
                let deleteButton = '';
                if (!isDefaultCategory) {
                    deleteButton = `<button class="circle-action-btn circle-delete" onclick="event.stopPropagation(); deleteExpenseCategory(${category.id})">√ó</button>`;
                }
                
                return `
                    <div class="circle-item circle-expense" onclick="editExpenseCategory(${category.id})">
                        <div class="circle-actions">${deleteButton}</div>
                        <div class="circle-icon">${icon}</div>
                        ${showAmount ? `<div class="circle-amount">${appData.settings.currency}${category.amount}</div>` : ''}
                        <div class="circle-label">${category.name}</div>
                    </div>
                `;
            }).join('');
        }

        // –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function() {
            console.log("Budget App: DOM loaded, starting app...");
            initApp();
        });

        // –†–µ–∑–µ—Ä–≤–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞ —Å–ª—É—á–∞–π –ø—Ä–æ–±–ª–µ–º
        window.addEventListener('load', function() {
            console.log("Budget App: Window loaded");
            // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—Å—Ç–∏–ª–æ—Å—å
            setTimeout(function() {
                if (document.getElementById('balance-amount').textContent === '‚ÇΩ0') {
                    console.log("Budget App: Backup initialization");
                    initApp();
                }
            }, 100);
        });
    </script>
</body>
</html>